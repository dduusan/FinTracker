========================================================================
  FINTRACKER BACKEND â€” LOG IMPLEMENTACIJE (Faza 1+2+3+4)
========================================================================

REDOSLED KREIRANJA I OBJAÅ NJENJA SVAKOG FAJLA:

========================================================================
1. STRUKTURA FOLDERA
========================================================================

backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/          â†’ Konfiguracija aplikacije (baza, env varijable, modeli)
â”‚   â”œâ”€â”€ middleware/       â†’ Middleware funkcije (error handling, auth u buduÄ‡nosti)
â”‚   â”œâ”€â”€ modules/          â†’ Poslovni moduli (svaki ima router, service, schemas)
â”‚   â”‚   â”œâ”€â”€ auth/         â†’ [Faza 3] Autentifikacija
â”‚   â”‚   â”œâ”€â”€ transactions/ â†’ CRUD za transakcije (prihodi/rashodi)
â”‚   â”‚   â”œâ”€â”€ categories/   â†’ [Faza 4] CRUD za kategorije transakcija
â”‚   â”‚   â”œâ”€â”€ budgets/      â†’ [Faza 4] BudÅ¾eti po kategorijama sa summary
â”‚   â”‚   â””â”€â”€ dashboard/    â†’ [Faza 5] Statistika i izveÅ¡taji
â”‚   â””â”€â”€ utils/            â†’ PomoÄ‡ne funkcije (greÅ¡ke, logger)
â”œâ”€â”€ migrations/           â†’ Alembic migracije baze podataka
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/             â†’ Unit testovi
â”‚   â””â”€â”€ integration/      â†’ Integracioni testovi
â””â”€â”€ frontend/             â†’ [Kasnije] React + Next.js

========================================================================
2. KONFIGURACIONI FAJLOVI (root)
========================================================================

requirements.txt
  â†’ Lista svih Python paketa koji se instaliraju sa "pip install -r requirements.txt"
  â†’ SadrÅ¾i: fastapi, uvicorn, sqlalchemy, asyncpg, alembic, pydantic, itd.

.env / .env.example
  â†’ Environment varijable (DATABASE_URL, APP_PORT, JWT_SECRET...)
  â†’ .env se NE COMMITUJE u git (u .gitignore je)
  â†’ .env.example sluÅ¾i kao template za druge developere

.gitignore
  â†’ Govori git-u koje fajlove da ignoriÅ¡e (.env, __pycache__, venv...)

========================================================================
3. src/config/ â€” KONFIGURACIJA
========================================================================

settings.py
  â†’ UÄitava environment varijable iz .env fajla koristeÄ‡i pydantic-settings
  â†’ Klasa Settings definiÅ¡e sve env varijable sa default vrednostima
  â†’ Exportuje "settings" objekat koji se koristi svuda u aplikaciji
  â†’ Primer: settings.DATABASE_URL, settings.APP_PORT

database.py
  â†’ Kreira SQLAlchemy async engine (konekcija ka PostgreSQL bazi)
  â†’ DefiniÅ¡e async_session â€” factory za kreiranje DB sesija
  â†’ Base klasa â€” svi SQLAlchemy modeli nasleÄ‘uju ovu klasu
  â†’ get_db() â€” FastAPI dependency koji daje DB sesiju po request-u
    (otvara sesiju na poÄetku requesta, zatvara na kraju)

models.py
  â†’ DefiniÅ¡e SVE tabele u bazi podataka kao Python klase:
    - User: korisnici (id, email, password, name, created_at)
    - Category: kategorije transakcija (id, user_id, name, type, icon)
    - Transaction: transakcije (id, user_id, category_id, amount, type, description, date)
    - Budget: budÅ¾eti po kategoriji i mesecu (id, user_id, category_id, amount, month)
  â†’ TransactionType enum: "income" ili "expense"
  â†’ relationship() definiÅ¡e veze izmeÄ‘u tabela (npr. User ima mnogo Transaction-a)

========================================================================
4. src/utils/ â€” POMOÄ†NE FUNKCIJE
========================================================================

errors.py
  â†’ Custom klase za greÅ¡ke koje aplikacija moÅ¾e baciti:
    - AppError: bazna klasa (message + status_code)
    - NotFoundError(404): resurs nije pronaÄ‘en
    - ValidationError(400): nevalidan input
    - AuthError(401): neautorizovan pristup
  â†’ Error handler u middleware-u hvata ove greÅ¡ke i vraÄ‡a JSON odgovor

logger.py
  â†’ KonfiguriÅ¡e Python logging sa formatiranim ispisom u konzolu
  â†’ U development modu loguje DEBUG nivo, inaÄe INFO
  â†’ Format: "2026-02-10 15:30:00 | INFO     | fintracker | poruka"
  â†’ Exportuje "logger" objekat koji se koristi svuda

========================================================================
5. src/modules/transactions/ â€” TRANSACTIONS MODUL
========================================================================

schemas.py (Pydantic Å¡eme â€” VALIDACIJA)
  â†’ DefiniÅ¡e oblik podataka koji ulaze i izlaze iz API-ja:
    - TransactionCreate: Å¡ta klijent Å¡alje kad pravi transakciju
      (amount > 0, type, category_id, description, date)
    - TransactionUpdate: Å¡ta klijent moÅ¾e da izmeni (sva polja opciona)
    - TransactionResponse: Å¡ta API vraÄ‡a klijentu
    - TransactionFilters: query parametri za filtriranje liste
      (type, category_id, date_from, date_to, page, per_page)
  â†’ Pydantic automatski validira podatke i vraÄ‡a greÅ¡ke ako su nevalidni

service.py (BIZNIS LOGIKA â€” sve DB operacije)
  â†’ Funkcije koje rade sa bazom podataka:
    - create_transaction(): kreira novu transakciju u bazi
    - get_transactions(): lista transakcija sa filterima i paginacijom
    - get_transaction_by_id(): jedna transakcija (baca NotFoundError ako ne postoji)
    - update_transaction(): menja polja transakcije (samo ona koja su poslata)
    - delete_transaction(): briÅ¡e transakciju iz baze
  â†’ Svaka funkcija prima db sesiju i user_id (za izolaciju po korisniku)

router.py (API ENDPOINTI â€” HTTP rute)
  â†’ DefiniÅ¡e URL putanje i povezuje ih sa service funkcijama:
    POST   /api/transactions/          â†’ kreiranje
    GET    /api/transactions/          â†’ lista (sa filtrima i paginacijom)
    GET    /api/transactions/{id}      â†’ jedna transakcija
    PUT    /api/transactions/{id}      â†’ izmena
    DELETE /api/transactions/{id}      â†’ brisanje
  â†’ Depends(get_current_user): izvlaÄi korisnika iz JWT tokena (Faza 3)
  â†’ Depends(get_db): FastAPI automatski otvara/zatvara DB sesiju

========================================================================
6. src/middleware/ â€” MIDDLEWARE
========================================================================

auth.py (FAZA 3 â€” JWT auth middleware)
  â†’ get_current_user(): FastAPI dependency koji:
    1. ÄŒita Authorization header (Bearer <token>)
    2. Dekodira JWT token i izvlaÄi user_id
    3. UÄitava korisnika iz baze
    4. VraÄ‡a User objekat koji se koristi u endpoint-ima
  â†’ Svaki zaÅ¡tiÄ‡eni endpoint dodaje: current_user: User = Depends(get_current_user)

error_handler.py
  â†’ Dva handler-a koje FastAPI poziva kad se desi greÅ¡ka:
    - app_error_handler: hvata naÅ¡e custom greÅ¡ke (AppError, NotFoundError...)
      i vraÄ‡a JSON sa odgovarajuÄ‡im status kodom
    - generic_error_handler: hvata sve ostale neoÄekivane greÅ¡ke
      i vraÄ‡a generiÄki 500 Internal Server Error
  â†’ Loguje svaku greÅ¡ku sa URL-om i metodom

========================================================================
7. src/modules/auth/ â€” AUTH MODUL (Faza 3)
========================================================================

schemas.py (Pydantic Å¡eme za auth)
  â†’ RegisterRequest: email (5-255 char), password (6-128 char), name (opciono)
  â†’ LoginRequest: email + password
  â†’ TokenResponse: access_token + refresh_token + token_type
  â†’ UserResponse: id, email, name (Å¡ta API vraÄ‡a o korisniku)

service.py (Auth biznis logika)
  â†’ Password:
    - hash_password(): heÅ¡ira lozinku sa bcrypt (nikad ne Äuvamo plaintext!)
    - verify_password(): poredi plaintext sa heÅ¡om
  â†’ JWT tokeni:
    - create_access_token(): kratak token (30 min) za pristup API-ju
    - create_refresh_token(): dugaÄak token (7 dana) za obnovu access tokena
    - decode_token(): dekodira token, proverava tip i istek
  â†’ User operacije:
    - register_user(): kreira novog korisnika (proverava da email nije zauzet)
    - authenticate_user(): proverava email + password, vraÄ‡a usera
    - get_user_by_id(): uÄitava usera po ID-u

router.py (Auth API endpointi)
  â†’ POST /api/auth/register  â†’ registracija (vraÄ‡a UserResponse)
  â†’ POST /api/auth/login     â†’ login (vraÄ‡a access + refresh token)
  â†’ POST /api/auth/refresh   â†’ novi access token pomoÄ‡u refresh tokena
  â†’ GET  /api/auth/me        â†’ podaci o trenutnom korisniku (zahteva token)

========================================================================
8. seed.py â€” TEST PODACI
========================================================================

  â†’ Skripta koja ubacuje test korisnika i kategorije u bazu:
    - User: test@test.com / test123
    - 6 kategorija: Plata, Freelance, Hrana, Transport, Stanarina, Zabava
  â†’ PokreÄ‡e se sa: python seed.py

========================================================================
9. src/app.py â€” ULAZNA TAÄŒKA APLIKACIJE
========================================================================

  â†’ Glavni fajl koji pokreÄ‡e FastAPI server
  â†’ lifespan(): izvrÅ¡ava se pri pokretanju (kreira tabele) i gaÅ¡enju servera
  â†’ Registruje error handler-e i router-e (auth, transactions, categories, budgets)
  â†’ /api/health endpoint za proveru da li server radi
  â†’ PokreÄ‡e uvicorn sa auto-reload u development modu

========================================================================
10. src/modules/categories/ â€” CATEGORIES MODUL (Faza 4)
========================================================================

schemas.py (Pydantic Å¡eme za kategorije)
  â†’ CategoryCreate: name (1-100 char), type (income/expense), icon (opciono)
  â†’ CategoryUpdate: sva polja opciona
  â†’ CategoryResponse: id, name, type, icon

service.py (Categories biznis logika)
  â†’ create_category(): kreira kategoriju (proverava da ne postoji duplikat)
  â†’ get_categories(): lista kategorija sa opcionalnim filterom po tipu
  â†’ get_category_by_id(): jedna kategorija (baca NotFoundError)
  â†’ update_category(): menja polja kategorije
  â†’ delete_category(): briÅ¡e kategoriju
  â†’ Svaka funkcija izoluje podatke po user_id

router.py (Categories API endpointi)
  â†’ POST   /api/categories/          â†’ kreiranje nove kategorije
  â†’ GET    /api/categories/          â†’ lista (filter po type: income/expense)
  â†’ GET    /api/categories/{id}      â†’ jedna kategorija
  â†’ PUT    /api/categories/{id}      â†’ izmena
  â†’ DELETE /api/categories/{id}      â†’ brisanje
  â†’ Svi endpointi zahtevaju JWT token (get_current_user)

========================================================================
11. src/modules/budgets/ â€” BUDGETS MODUL (Faza 4)
========================================================================

schemas.py (Pydantic Å¡eme za budÅ¾ete)
  â†’ BudgetCreate: category_id, amount (>0), month (prvi dan meseca)
  â†’ BudgetUpdate: amount i month opcioni
  â†’ BudgetResponse: id, category_id, amount, month
  â†’ BudgetSummaryItem: category_name, budgeted, spent, remaining, month
  â†’ BudgetFilters: month, category_id (opcioni filteri)

service.py (Budgets biznis logika)
  â†’ create_budget(): kreira budÅ¾et (proverava kategoriju i duplikat)
  â†’ get_budgets(): lista budÅ¾eta sa filterima (mesec, kategorija)
  â†’ get_budget_by_id(): jedan budÅ¾et (baca NotFoundError)
  â†’ update_budget(): menja iznos ili mesec
  â†’ delete_budget(): briÅ¡e budÅ¾et
  â†’ get_budget_summary(): SPECIJALNA FUNKCIJA
    - Za dati mesec vraÄ‡a sve budÅ¾ete sa potrosenim iznosom
    - RaÄuna "spent" iz tabele Transaction (expense tip, isti mesec)
    - VraÄ‡a: budgeted, spent, remaining za svaku kategoriju

router.py (Budgets API endpointi)
  â†’ POST   /api/budgets/             â†’ kreiranje novog budÅ¾eta
  â†’ GET    /api/budgets/             â†’ lista (filter po month, category_id)
  â†’ GET    /api/budgets/summary?month=2026-02-01 â†’ pregled potroÅ¡nje
  â†’ GET    /api/budgets/{id}         â†’ jedan budÅ¾et
  â†’ PUT    /api/budgets/{id}         â†’ izmena
  â†’ DELETE /api/budgets/{id}         â†’ brisanje
  â†’ Svi endpointi zahtevaju JWT token

========================================================================
POKRETANJE:
========================================================================

  1. python -m venv venv              â†’ kreira virtualno okruÅ¾enje
  2. venv\Scripts\activate            â†’ aktivira ga (Windows)
  3. pip install -r requirements.txt  â†’ instalira pakete
  4. docker compose up -d             â†’ pokreÄ‡e PostgreSQL + Redis u Dockeru
  5. python seed.py                   â†’ ubacuje test korisnika i kategorije
  6. python -m uvicorn src.app:app --reload --port 8000  â†’ pokreÄ‡e server
  7. Otvori http://localhost:8000/docs â†’ Swagger UI za testiranje API-ja

========================================================================
TESTIRANJE AUTH FLOW-a:
========================================================================

  1. POST /api/auth/register â†’ kreiraj nalog (ili koristi seed korisnika)
  2. POST /api/auth/login    â†’ email: test@test.com, password: test123
     â†’ dobijaÅ¡ access_token i refresh_token
  3. Kopiraj access_token i dodaj ga u Swagger "Authorize" dugme:
     Bearer <access_token>
  4. Sad moÅ¾eÅ¡ koristiti sve zaÅ¡tiÄ‡ene endpointe
  5. GET /api/auth/me â†’ proverava ko si
  6. POST /api/auth/refresh â†’ kad access_token istekne (30 min)

========================================================================
TESTIRANJE CATEGORIES + BUDGETS (Faza 4):
========================================================================

  (Prethodno se uloguj i dodaj Bearer token u Swagger)

  CATEGORIES:
  1. GET  /api/categories/          â†’ lista kategorija (seed je napravio 6)
  2. POST /api/categories/          â†’ nova kategorija:
     {"name": "Investicije", "type": "income", "icon": "ğŸ“ˆ"}
  3. GET  /api/categories/?type=expense â†’ samo expense kategorije
  4. PUT  /api/categories/{id}      â†’ izmeni kategoriju
  5. DELETE /api/categories/{id}    â†’ obriÅ¡i kategoriju

  BUDGETS:
  1. POST /api/budgets/             â†’ novi budÅ¾et:
     {"category_id": 3, "amount": 15000, "month": "2026-02-01"}
  2. GET  /api/budgets/             â†’ lista svih budÅ¾eta
  3. GET  /api/budgets/?month=2026-02-01 â†’ budÅ¾eti za februar
  4. GET  /api/budgets/summary?month=2026-02-01
     â†’ pregled: koliko je budÅ¾etirano vs potroÅ¡eno za svaku kategoriju
  5. PUT  /api/budgets/{id}         â†’ izmeni iznos budÅ¾eta
  6. DELETE /api/budgets/{id}       â†’ obriÅ¡i budÅ¾et
